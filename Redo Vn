--[[
    ‚úÖ Redo VN - ESP NPC üáªüá≥
    ‚úÖ Made by @Redovn-Y8c / V1.14
    ‚úÖ https://www.youtube.com/@RedoVn-y8c
--]]

local Players = game:GetService("Players")
local RS = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LP = Players.LocalPlayer

local gui = Instance.new("ScreenGui", LP:WaitForChild("PlayerGui"))
gui.Name = "RedoVN_ESP_GUI"
gui.ResetOnSpawn = false

-- Toggle Button
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0, 100)
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.Text = "üëÅÔ∏è Toggle ESP"
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 13
toggleBtn.Draggable = true
toggleBtn.Active = true

-- Main Frame
local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.new(0, 280, 0, 400)
mainFrame.Position = UDim2.new(0, 10, 0, 140)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainFrame.Visible = false
mainFrame.Active = true
mainFrame.Draggable = true
Instance.new("UICorner", mainFrame)

-- Title
local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
title.Text = "Redo VN - ESP NPC üáªüá≥"
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.TextColor3 = Color3.new(1,1,1)

-- YouTube Button
local linkBtn = Instance.new("TextButton", mainFrame)
linkBtn.Size = UDim2.new(1, -20, 0, 25)
linkBtn.Position = UDim2.new(0, 10, 0, 35)
linkBtn.Text = "üîó YouTube: RedoVN"
linkBtn.Font = Enum.Font.GothamSemibold
linkBtn.TextSize = 13
linkBtn.TextColor3 = Color3.new(1,1,1)
linkBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Instance.new("UICorner", linkBtn)
linkBtn.MouseButton1Click:Connect(function()
    setclipboard("https://www.youtube.com/@RedoVn-y8c")
end)

-- Credit
local credit = Instance.new("TextLabel", mainFrame)
credit.Size = UDim2.new(1, 0, 0, 20)
credit.Position = UDim2.new(0, 0, 0, 65)
credit.BackgroundTransparency = 1
credit.Text = "Made by @Redovn-Y8c / V1.14"
credit.Font = Enum.Font.Gotham
credit.TextSize = 12
credit.TextColor3 = Color3.fromRGB(180,180,180)

-- Search
local searchBox = Instance.new("TextBox", mainFrame)
searchBox.Size = UDim2.new(1, -20, 0, 25)
searchBox.Position = UDim2.new(0, 10, 0, 360)
searchBox.PlaceholderText = "üîç Search NPC name"
searchBox.Font = Enum.Font.Gotham
searchBox.TextSize = 13
searchBox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
searchBox.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", searchBox)

-- Scroll NPC list
local scroll = Instance.new("ScrollingFrame", mainFrame)
scroll.Size = UDim2.new(1, -10, 0, 260)
scroll.Position = UDim2.new(0, 5, 0, 90)
scroll.CanvasSize = UDim2.new(0, 0, 10, 0)
scroll.ScrollBarThickness = 4
scroll.BackgroundTransparency = 1
scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y

local layout = Instance.new("UIListLayout", scroll)
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Padding = UDim.new(0, 4)

-- Rainbow color
local rainbow = 0
local function getRainbowColor()
    rainbow += 0.01
    return Color3.fromHSV(rainbow % 1, 1, 1)
end

-- Toggle GUI
toggleBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

-- NPC ESP system
local espTargets = {}

local function createToggle(name, model)
    local data = {Enabled = false, Model = model, Line = nil}
    espTargets[name] = data

    local button = Instance.new("TextButton", scroll)
    button.Size = UDim2.new(1, -10, 0, 30)
    button.Text = "[OFF] " .. name
    button.TextColor3 = Color3.new(1,1,1)
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 13
    button.TextXAlignment = Enum.TextXAlignment.Left
    Instance.new("UICorner", button)

    button.MouseButton1Click:Connect(function()
        data.Enabled = not data.Enabled
        button.Text = (data.Enabled and "[ON] " or "[OFF] ") .. name
    end)
end

-- Search filter
searchBox:GetPropertyChangedSignal("Text"):Connect(function()
    local keyword = searchBox.Text:lower()
    for _, btn in ipairs(scroll:GetChildren()) do
        if btn:IsA("TextButton") then
            btn.Visible = keyword == "" or btn.Text:lower():find(keyword)
        end
    end
end)

-- NPC Detection
local function detectNPCs()
    for _, npc in pairs(workspace:GetDescendants()) do
        if npc:IsA("Model") then
            local humanoid = npc:FindFirstChildWhichIsA("Humanoid", true)
            local root = npc:FindFirstChild("HumanoidRootPart", true) or npc:FindFirstChild("Root", true)
            if humanoid and root and not espTargets[npc.Name] then
                createToggle(npc.Name, npc)
            end
        end
    end
end

-- Call once
detectNPCs()

-- ESP render
local function createESP(model, data)
    local bb = Instance.new("BillboardGui", gui)
    bb.Name = "ESP_TAG"
    bb.Adornee = model:FindFirstChild("HumanoidRootPart", true)
    bb.Size = UDim2.new(0, 200, 0, 50)
    bb.StudsOffset = Vector3.new(0, 3, 0)
    bb.AlwaysOnTop = true

    local nameText = Instance.new("TextLabel", bb)
    nameText.Size = UDim2.new(1, 0, 0.5, 0)
    nameText.BackgroundTransparency = 1
    nameText.Font = Enum.Font.GothamBold
    nameText.TextSize = 14
    nameText.TextStrokeTransparency = 0.4
    nameText.TextColor3 = Color3.new(1,1,1)

    local studText = Instance.new("TextLabel", bb)
    studText.Position = UDim2.new(0, 0, 0.5, 0)
    studText.Size = UDim2.new(1, 0, 0.5, 0)
    studText.BackgroundTransparency = 1
    studText.Font = Enum.Font.Gotham
    studText.TextSize = 12
    studText.TextColor3 = Color3.fromRGB(180,180,180)

    local line = Drawing.new("Line")
    line.Thickness = 1.5
    line.Transparency = 0.8
    data.Line = line

    local conn
    conn = RS.RenderStepped:Connect(function()
        if not model or not data.Enabled then
            bb:Destroy()
            line.Visible = false
            conn:Disconnect()
            return
        end

        local root = model:FindFirstChild("HumanoidRootPart", true)
        local char = LP.Character
        local plrRoot = char and char:FindFirstChild("HumanoidRootPart")

        if not root or not plrRoot then return end

        nameText.Text = model.Name
        nameText.TextColor3 = getRainbowColor()

        local dist = (plrRoot.Position - root.Position).Magnitude
        studText.Text = string.format("%.0f Studs", dist)

        local npcPos, onScreen = Camera:WorldToViewportPoint(root.Position)
        local playerPos, playerOnScreen = Camera:WorldToViewportPoint(plrRoot.Position)

        if onScreen then
            bb.Enabled = true
            line.From = playerOnScreen and Vector2.new(playerPos.X, playerPos.Y) or Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
            line.To = Vector2.new(npcPos.X, npcPos.Y)
            line.Color = getRainbowColor()
            line.Visible = true
        else
            bb.Enabled = false
            line.Visible = false
        end
    end)
end

RS.RenderStepped:Connect(function()
    for _, data in pairs(espTargets) do
        if data.Enabled then
            local model = data.Model
            if not gui:FindFirstChild("ESP_TAG") then
                createESP(model, data)
            end
        end
    end
end)
