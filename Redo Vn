--// Redo VN ESP - NPC 🇻🇳 Script V1.09
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local mouse = player:GetMouse()
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")

local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "RedoVN_ESP_GUI"
ScreenGui.ResetOnSpawn = false

-- Toggle Button (Draggable)
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 130, 0, 40)
toggleButton.Position = UDim2.new(0.02, 0, 0.1, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleButton.Text = "👁️ Redo VN ESP - NPC 🇻🇳"
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 16
toggleButton.Parent = ScreenGui
toggleButton.Active = true
toggleButton.Draggable = true

-- Main GUI
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 300, 0, 400)
mainFrame.Position = UDim2.new(0.02, 0, 0.2, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainFrame.Parent = ScreenGui
mainFrame.Visible = true
mainFrame.Active = true
mainFrame.Draggable = true

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.Text = "🇻🇳 Redo VN ESP - NPC"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.Parent = mainFrame

-- Credit + Version Info
local credit = Instance.new("TextLabel")
credit.Size = UDim2.new(1, 0, 0, 20)
credit.Position = UDim2.new(0, 0, 0, 40)
credit.BackgroundTransparency = 1
credit.Text = "📌 Made by @RedoVn-y8c | V1.79 update coming soon"
credit.TextColor3 = Color3.fromRGB(255, 255, 0)
credit.Font = Enum.Font.Gotham
credit.TextSize = 14
credit.Parent = mainFrame

-- Search Box
local searchBox = Instance.new("TextBox")
searchBox.PlaceholderText = "🔍 Search NPC..."
searchBox.Size = UDim2.new(1, -10, 0, 30)
searchBox.Position = UDim2.new(0, 5, 0, 70)
searchBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
searchBox.TextColor3 = Color3.new(1, 1, 1)
searchBox.Font = Enum.Font.Gotham
searchBox.TextSize = 14
searchBox.ClearTextOnFocus = false
searchBox.Parent = mainFrame

-- Scroll Frame
local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1, -10, 1, -120)
scroll.Position = UDim2.new(0, 5, 0, 110)
scroll.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
scroll.ScrollBarThickness = 4
scroll.Parent = mainFrame

local UIList = Instance.new("UIListLayout", scroll)
UIList.Padding = UDim.new(0, 5)

-- Variables
local NPC_ESP = {}
local proximityShown = {}
local espColor = Color3.new(0, 1, 0)
local rainbowToggle = true

-- Rainbow Effect
task.spawn(function()
	while rainbowToggle do
		local t = tick() % 5
		espColor = Color3.fromHSV(t / 5, 1, 1)
		wait(0.1)
	end
end)

-- ESP Function
function addESP(npc)
	if NPC_ESP[npc] then return end

	local Billboard = Instance.new("BillboardGui")
	Billboard.Adornee = npc:FindFirstChild("Head") or npc:FindFirstChildWhichIsA("BasePart")
	Billboard.Size = UDim2.new(0, 200, 0, 50)
	Billboard.StudsOffset = Vector3.new(0, 3, 0)
	Billboard.AlwaysOnTop = true
	Billboard.Name = "NPC_ESP"
	Billboard.Parent = npc

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.TextColor3 = espColor
	label.Text = "- " .. npc.Name
	label.TextSize = 14
	label.Font = Enum.Font.GothamBold
	label.TextStrokeTransparency = 0 -- Strikethrough effect simulation
	label.Parent = Billboard

	NPC_ESP[npc] = Billboard
end

function removeESP(npc)
	if NPC_ESP[npc] then
		NPC_ESP[npc]:Destroy()
		NPC_ESP[npc] = nil
	end
end

-- Proximity Notification
RunService.RenderStepped:Connect(function()
	for npc, esp in pairs(NPC_ESP) do
		if npc and npc:FindFirstChild("HumanoidRootPart") then
			local char = player.Character
			if not char or not char:FindFirstChild("HumanoidRootPart") then continue end
			local dist = (npc.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Magnitude
			if dist >= 30 and dist <= 125 and not proximityShown[npc] then
				proximityShown[npc] = true
				local notice = Instance.new("TextLabel", ScreenGui)
				notice.Text = "📢 " .. npc.Name .. " is near you! (" .. math.floor(dist) .. " studs)"
				notice.Size = UDim2.new(0.4, 0, 0, 30)
				notice.Position = UDim2.new(0.3, 0, 0.01, 0)
				notice.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
				notice.TextColor3 = Color3.new(1, 1, 1)
				notice.Font = Enum.Font.GothamBold
				notice.TextSize = 14
				wait(3)
				notice:Destroy()
			end
		end
	end
end)

-- Load NPCs
function loadNPCs()
	scroll:ClearAllChildren()
	UIList.Parent = scroll

	for _, obj in pairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and obj:FindFirstChildOfClass("Humanoid") then
			local npc = obj
			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(1, -10, 0, 30)
			btn.Text = npc.Name
			btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
			btn.TextColor3 = Color3.new(1, 1, 1)
			btn.Font = Enum.Font.Gotham
			btn.TextSize = 14
			btn.Parent = scroll

			btn.MouseButton1Click:Connect(function()
				if NPC_ESP[npc] then
					removeESP(npc)
					btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
				else
					addESP(npc)
					btn.BackgroundColor3 = espColor
				end
			end)
		end
	end
end

-- Live update for new NPCs
workspace.ChildAdded:Connect(function(obj)
	task.wait(1)
	if obj:IsA("Model") and obj:FindFirstChildOfClass("Humanoid") then
		local npc = obj
		local btn = Instance.new("TextButton", scroll)
		btn.Size = UDim2.new(1, -10, 0, 30)
		btn.Text = npc.Name
		btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
		btn.TextColor3 = Color3.new(1, 1, 1)
		btn.Font = Enum.Font.Gotham
		btn.TextSize = 14

		btn.MouseButton1Click:Connect(function()
			if NPC_ESP[npc] then
				removeESP(npc)
				btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
			else
				addESP(npc)
				btn.BackgroundColor3 = espColor
			end
		end)
	end
end)

-- Search Function
searchBox:GetPropertyChangedSignal("Text"):Connect(function()
	local text = searchBox.Text:lower()
	for _, btn in ipairs(scroll:GetChildren()) do
		if btn:IsA("TextButton") then
			btn.Visible = btn.Text:lower():find(text) ~= nil
		end
	end
end)

-- Toggle GUI
toggleButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
end)

-- Initial Load
loadNPCs()
